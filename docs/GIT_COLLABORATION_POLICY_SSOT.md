# Git Collaboration Policy (SSOT Addendum)

본 프로젝트의 Git 협업은 `README.md`에 명시된 Agent Collaboration Protocol을 단일 진실 원천(SSOT)으로 삼는다.
모든 작업은 해당 문서를 기준으로 판단하며, 규칙 해석에 충돌이 있을 경우 SSOT를 우선한다.

## 1) 시작 전 필수

1. 작업을 시작하기 전에는 반드시 `docs/AGENT_WATCH_LOG.md`에 START 기록을 남긴다.
2. START 기록에는 작업 목적, 사용할 브랜치, 시작 시점의 `main` 커밋 해시를 명확히 기록한다.
3. 로그 기록 없이 작업을 진행하지 않는다.

## 2) 작업 전 상태 점검

1. 모든 작업자는 작업 전에 현재 Git 상태를 점검해야 한다.
2. `git status --short --branch`로 현재 브랜치, 워크트리 상태, 예기치 않은 변경 사항 유무를 확인한다.
3. `main` 브랜치에서 직접 작업을 시작해서는 안 된다.

## 3) main 브랜치 보호

1. `main`은 항상 안정 상태를 유지해야 한다.
2. `main`에 직접 push하는 행위는 금지하며, 모든 변경은 Pull Request를 통해서만 반영한다.
3. `main`에 대해 rebase 또는 force push를 수행하는 것은 절대 허용되지 않는다.

## 4) 개인 브랜치 규칙

1. 개인 작업은 반드시 `codex/<task-name>` 형식의 개인 브랜치에서 수행한다.
2. 개인 브랜치에서는 히스토리 정리를 위한 rebase가 허용된다.
3. rebase 이후 원격 반영이 필요할 경우 `--force-with-lease`만 사용할 수 있다.
4. `--force-with-lease`는 사용자 허가가 있는 경우에만 수행한다.

## 5) 공유 브랜치 규칙

1. 두 명 이상이 사용하는 공유 브랜치에서는 rebase를 금지한다.
2. 공유 브랜치 히스토리는 변경하지 않는다.
3. 최신 `main` 반영 시 merge 방식만 사용한다.
4. 공유 브랜치에 대한 force push는 어떠한 경우에도 허용되지 않는다.

## 6) PR 전 정리

1. Pull Request 생성 전 반드시 최신 `main` 기준으로 브랜치를 정리한다.
2. 개인 브랜치는 rebase 또는 merge가 가능하다.
3. 공유 브랜치는 merge만 허용된다.

## 7) 머지 전략

1. `main` 머지는 안정성을 우선하며 표준 머지 전략(예: squash merge 또는 merge commit)을 따른다.
2. 기본 정책과 다른 머지 전략은 사용자의 명시적 허가가 필요하다.
3. 허가 없는 예외 전략 사용은 금지한다.

## 8) 검증 게이트

1. 모든 push/merge 이전에는 검증 게이트를 통과해야 한다.
2. `npm run check`와 `npm run build`가 모두 성공해야 한다.
3. 하나라도 실패한 상태에서는 어떠한 형태의 push도 수행하지 않는다.

## 9) main 재검증

1. `main`에 머지된 이후에는 반드시 `main` 브랜치에서 다시 `npm run check`와 `npm run build`를 실행한다.
2. `main`은 항상 빌드 가능하고 검증 가능한 상태를 유지해야 한다.

## 10) 작업 완료 로그

1. 작업 완료 시 `docs/AGENT_WATCH_LOG.md`에 FINISH 기록을 남긴다.
2. 변경 내용 요약, 검증 결과, 작업 브랜치 커밋 해시, 머지 커밋 해시, 최종 push 상태를 명확히 기록한다.
3. 로그는 작업 이력의 공식 기록으로 간주한다.

## 11) 승인 정책

1. push 및 merge는 사용자 요청 또는 명시적 허가가 있는 경우에만 진행한다.
2. 승인되지 않은 force push는 금지한다.
3. 특히 `main`과 공유 브랜치에 대한 force push는 어떠한 경우에도 허용되지 않는다.

## 12) 운영 목적

본 운영 방식의 목적은 다중 클론 및 다중 에이전트 환경에서 히스토리 충돌을 방지하고,
빌드 안정성을 유지하며, 모든 변경을 추적 가능하게 만드는 데 있다.
`main`은 안정성을 우선으로 하고, 개인 브랜치는 자율성을 허용하되, 공유 영역에서는 보수적으로 운영한다.
